#!/usr/bin/env node

const dotenv = require('dotenv');
dotenv.load();

const constants = require('../special-calculations/data/constants');
const {
  CUR_YEAR,
  PREV_YEAR,
  DECENNIAL_CUR_YEAR,
  DECENNIAL_PREV_YEAR,
} = constants;

const pgp = require('pg-promise')({
  query(e) {
     (process.env.DEBUG === 'true') ? console.log(e.query) : null; // eslint-disable-line
  },
});

const db = pgp(process.env.DATABASE_URL);

db.query(`
  TRUNCATE TABLE public.demographic;
  TRUNCATE TABLE public.housing;
  TRUNCATE TABLE public.economic;
  TRUNCATE TABLE public.social;

  INSERT INTO public.demographic
  SELECT * FROM pff_demographic."${CUR_YEAR}" UNION ALL SELECT * FROM pff_demographic."${PREV_YEAR}";

  INSERT INTO public.housing
  SELECT * FROM pff_housing."${CUR_YEAR}" UNION ALL SELECT * FROM pff_housing."${PREV_YEAR}";

  INSERT INTO public.economic
  SELECT * FROM pff_economic."${CUR_YEAR}" UNION ALL SELECT * FROM pff_economic."${PREV_YEAR}";

  INSERT INTO public.social
  SELECT * FROM pff_social."${CUR_YEAR}" UNION ALL SELECT * FROM pff_social."${PREV_YEAR}";
`);
